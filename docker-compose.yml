# see CONTRIBUTING.md
---
version: '3'
services:
  test_db:
    image: aleksi/test_db:1.1.0
    volumes:
      - test_db_mysql:/test_db/mysql/world:ro

  proxysql:
    image: ${PROXYSQL_IMAGE:-percona/proxysql:latest}
    environment:
      # those environment variables are not actually required by ProxySQL, but entrypoint erroneously checks them
      - CLUSTER_NAME=dummy
      - DISCOVERY_SERVICE=dummy
    ports:
      - 127.0.0.1:13306:3306  # user interface
      - 127.0.0.1:16032:6032  # admin interface

  master:
    image: ${MASTER_IMAGE:-percona:5.7}
    environment:
      - MYSQL_ALLOW_EMPTY_PASSWORD=yes
      - MYSQL_USER=monitor
      - MYSQL_PASSWORD=monitor
    ports:
      - 127.0.0.1:3307:3306
    volumes:
      - test_db_mysql:/docker-entrypoint-initdb.d/:ro

  slave:
    image: ${SLAVE_IMAGE:-percona:5.7}
    environment:
      - MYSQL_ALLOW_EMPTY_PASSWORD=yes
      - MYSQL_USER=monitor
      - MYSQL_PASSWORD=monitor
    ports:
      - 127.0.0.1:3308:3306

volumes:
  test_db_mysql:
